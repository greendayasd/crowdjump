{% verbatim %}
<div class="container chatcontainer" ng-controller="ChatController as vm" ng-show="vm.isAuthenticated" style="width: 100%">
    <div class="row">
        <div class="col-md-12 pre-scrollable" id="all_messages">
            <div ng-repeat="message in chatMessages" id="chat">
                <div [innerHTML]="text" style="background-color: white">
                    <strong>{{ message.user.username }}:</strong> {{ message.message_html }}
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12" ng-show="chatMessages.length < 1">
        <div id="no_messages">No messages here</div>
    </div>
    <div class="row">
        <form id="chatform">
            <div class="col-md-12">
                <input id="chat-message-input" type="text" class="form-control input-lg"
                       placeholder="Type message here"
                       required>
            </div>
            <div class="col-xs-2 col-sm-1">
                <button id="chat-message-submit" type="button" class="btn btn-primary input-lg" value="Send"
                        style="visibility:hidden">Submit
                </button>
            </div>

        </form>
    </div>
</div>

<script>

    var roomName = '123';

    var ws_scheme = 'wss'; //window.location.protocol == "https:" ? "wss" : "ws";

    var port = ':8001';
    if (window.location.host == "localhost:8000") {
        ws_scheme = 'ws';
        port = '';
    }
    var chatSocket = new WebSocket(
        ws_scheme + '://' + window.location.host + port +
        '/ws/chat/' + roomName + '/');


    chatSocket.onmessage = function (message) {

        if ($("#no_messages").length) {
            $("#no_messages").remove();
        }

        var data = JSON.parse(message.data);
        var chat = $("#all_messages")
        var ele = $('<div [innerHTML]="text" style="background-color: white"></div>')

        ele.append(
            ' <strong>' + data.username + ': </strong> ')

        ele.append(
            data.message)

        chat.append(ele)
        //$('#all_messages').scrollTop($('#all_messages')[0].scrollHeight);
        $('#all_messages').scrollTop($('#all_messages')[$('#all_messages').length - 1].scrollHeight);

        //notify
        var closed = document.querySelector('#sidebar');
        if (true) {
            alert(closed)
        }else {
            alert("test2")
        }
    };


    chatSocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly');
    };
    document.querySelector('#chat-message-input').focus();
    document.querySelector('#chat-message-input').onkeyup = function (e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#chat-message-submit').click();
        }
    };

    document.querySelector('#chat-message-submit').onclick = function (e) {
        var messageInputDom = document.querySelector('#chat-message-input');
        var message = messageInputDom.value;
        var datetime = new Date().format('d-m-Y h:i:s');

        chatSocket.send(JSON.stringify({
            'message': message,
            'datetime': datetime
        }));

        messageInputDom.value = '';
    };
</script>
{% endverbatim %}